# Day 14: 표토 저수지 (Regolith Reservoir)
<https://adventofcode.com/2022/day/14>

## Part 1
조난 신호가 당신을 거대한 폭포 뒤로 이끕니다! 여기에는 커다란 동굴이 있는 것 같고, 신호는 분명히 더 안쪽으로 이어집니다.

지하 깊숙이 들어갈 때, 당신은 잠시 땅이 덜컹거리는 것이 느꼈습니다. 모래가 동굴 안으로 쏟아지기 시작합니다! 모래가 어디로 가는지 빨리 파악하지 않으면, 당신은 금방 갇힐 것 입니다!

다행히 당신은 낙하물의 경로를 분석하는 것에 [익숙](https://adventofcode.com/2018/day/17)하기 때문에 문제가 없습니다. 당신은 동굴의 수직 구조(퍼즐 입력)를 스캔했고, 동굴은 특정 형태의 **암석**이 조금 있고 나머지는 비어있다는 것을 알아냈습니다.

스캔은 각 암석의 구조를 경로의 형태로 파악하고, 경로의 모양을 형성하는 `x,y` 좌표를 보고합니다. 여기서 `x`는 오른쪽으로의 거리를, `y`는 아래 쪽으로의 거리를 나타냅니다. 각 경로는 스캔에서 한 줄의 텍스트로 나타납니다. 각 경로의 첫 번째 점 다음의 각 점은 이전 점에서 그릴 직선의 수평 혹은 수직 선의 끝을 나타냅니다.

예를 들어 다음을 봅시다.

``` text
498,4 -> 498,6 -> 496,6
503,4 -> 502,4 -> 502,9 -> 494,9
```

이 스캔은 두 개의 암석 경로가 있음을 의미합니다. 첫 번째 경로는 두 개의 직선으로 구성되고 두 번째 경로는 세 개의 직선으로 구성됩니다. (구체적으로 첫 번째 경로는 `498,4`에서 `498,6`로 이어지는 암석으로 된 직선과 `498,6`에서 `496.6`으로 이어지는 암석으로 된 직선으로 구성됩니다.)

모래는 `500,0.` 지점에서 동굴안으로 쏟아지고 있습니다 

바위를 `#`으로, 빈 공간을 `.`으로, 모래가 쏟아지는 위치를 `+`로 그리면, 다음과 같이 그려집니다.

``` text
  4     5  5
  9     0  0
  4     0  3
0 ......+...
1 ..........
2 ..........
3 ..........
4 ....#...##
5 ....#...#.
6 ..###...#.
7 ........#.
8 ........#.
9 #########.
```

모래는 **한 번에 한 칸씩** 만들어지며, 이전 타임에 만들어진 모래가 **정지할 때까지** 다음 모래는 만들어지지 않습니다. 모래 한 칸은 스캔 결과의 빈 공간 하나를 채울 만큼 충분히 많습니다.

모래 한 칸은 가능한 경우 항상 **한 칸 아래**로 떨어집니다. 만약 바로 아래에 있는 타일이 바위나 모래로 막힌 경우, 모래는 대신 **대각선 왼쪽 아래 방향으로 한 칸** 이동하려고 시도합니다. 해당 타일 역시 막혀있으면, 모래는 대신 **대각선 오른쪽 아래로 한 칸** 이동하려고 시도합니다. 모래는 각 단계별로 바로 아래, 왼쪽 아래, 오른쪽 아래 순서로 이동을 시도해보며, 움직일 수 있는 한 계속 움직입니다. 세 개의 목적지가 모두 막히면, 모래는 **멈추고** 더 이상 움직이지 않습니다. 이 시점에서 다음 모래가 `+` 위치에서 다시 생성됩니다.

그러니 떨어진 모래를 `o`로 그려보면, 첫 번째 떨어지는 모래는 단순히 아래로 떨어집니다.

``` text
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
......o.#.
#########.
```

두 번째로 떨어지는 모래는 아래로 쭉 떨어지다가, 첫 번째로 떨어졌던 모래에 떨어진 다음, 그 왼쪽으로 떨어집니다.

``` text
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
........#.
.....oo.#.
#########.
```

다음으로 모래 5개가 떨어지고 난 이후 다음과 같은 형태가 됩니다.

``` text
......+...
..........
..........
..........
....#...##
....#...#.
..###...#.
......o.#.
....oooo#.
#########.
```

다음으로 22개의 모래가 떨어진 모습입니다.

``` text
......+...
..........
......o...
.....ooo..
....#ooo##
....#ooo#.
..###ooo#.
....oooo#.
...ooooo#.
#########.
```

마지막으로 2개의 모래가 더 떨어지고 난 이후의 모습입니다.

``` text
......+...
..........
......o...
.....ooo..
....#ooo##
...o#ooo#.
..###ooo#.
....oooo#.
.o.ooooo#.
#########.
```

위에 표시된 24개의 모래가 떨어진 이후에 떨어지는 모래들은 모두 바닥으로 흘러 끝없는 공허로 떨어지게 됩니다. 그저 재미를 위해, 새 모래가 영원히 떨어지러 가는 경로를 `~`로 표시해보면 다음과 같은 그림이 나옵니다.

``` text
.......+...
.......~...
......~o...
.....~ooo..
....~#ooo##
...~o#ooo#.
..~###ooo#.
..~..oooo#.
.~o.ooooo#.
~#########.
~..........
~..........
~..........
```

스캔을 사용하여 떨어지는 모래를 시뮬레이션하세요. 모래가 아래의 심연으로 흐르기 시작하려면, 몇 개의 모래가 떨어져야 합니까?

## Part 2
당신은 스캔이 잘못 되었다는 것을 알아차렸습니다. 스캔 하단에는 끝없는 공허가 있는게 아닙니다. 그곳에는 바닥이 있고, 당신은 그 위에 서 있습니다!

바닥을 스캔할 시간이 없으니 바닥이 무한한 수평선이며, `y` 좌표가 당신이 스캔한 벽면의 **가장 큰 `y` 좌표 값보다 2만큼 크다**고 가정합시다.

위의 예를 보면, 가장 큰 `y` 좌표는 `9`이기 때문에 바닥은 `y=10`이 됩니다. (이것은 스캔 결과에 다음과 같은 하나의 암석 경로가 추가된 것과 같습니다. `-infinity,11 -> infinity,11`) 바닥이 추가되면 이제 위의 예시는 다음과 같이 그려집니다.

``` text
        ...........+........
        ....................
        ....................
        ....................
        .........#...##.....
        .........#...#......
        .......###...#......
        .............#......
        .............#......
        .....#########......
        ....................
<-- etc #################### etc -->
```

안전하게 서 있을 수 있는 곳을 찾으려면, 모래가 최초 좌표인 `500,0`에서 멈춰 동굴로 들어오는 모래를 막을 때까지 시뮬레이션해야 합니다. 위의 예에서는 `93` 번째 모래가 떨어질 때 시뮬레이션이 종료되며, 최종적으로 다음과 같이 그려집니다.

``` text
............o............
...........ooo...........
..........ooooo..........
.........ooooooo.........
........oo#ooo##o........
.......ooo#ooo#ooo.......
......oo###ooo#oooo......
.....oooo.oooo#ooooo.....
....oooooooooo#oooooo....
...ooo#########ooooooo...
..ooooo.......ooooooooo..
#########################
```

스캔을 사용하여 모래가 떨어지는 근원이 막힐 때까지 시뮬레이션하세요. 그러기 위해서 몇 개의 모래가 떨어져야 합니까?